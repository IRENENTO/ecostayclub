<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>EcoStay Admin Dashboard - CMS</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: 'Inter', sans-serif;
      background: #f5f7fa;
      color: #2d3436;
    }

    .admin-container {
      display: flex;
      min-height: 100vh;
    }

    /* SIDEBAR */
    .sidebar {
      width: 280px;
      background: linear-gradient(135deg, #1A4D2E 0%, #2d6a4f 100%);
      color: white;
      padding: 30px 20px;
      position: fixed;
      height: 100vh;
      overflow-y: auto;
      box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
    }

    .sidebar-logo {
      font-size: 1.8rem;
      font-weight: 700;
      margin-bottom: 40px;
      padding-bottom: 20px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.2);
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .sidebar-nav { list-style: none; }
    .sidebar-nav li { margin-bottom: 10px; }

    .sidebar-nav button {
      width: 100%;
      background: none;
      border: none;
      color: rgba(255, 255, 255, 0.8);
      padding: 12px 15px;
      text-align: left;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s;
      font-size: 0.95rem;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .sidebar-nav button:hover,
    .sidebar-nav button.active {
      background: rgba(255, 255, 255, 0.15);
      color: white;
    }

    .sidebar-nav button i { width: 20px; text-align: center; }

    /* MAIN CONTENT */
    .main-content {
      margin-left: 280px;
      flex: 1;
      padding: 30px;
      max-width: 1400px;
    }

    .topbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: white;
      padding: 20px 30px;
      border-radius: 12px;
      margin-bottom: 30px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .topbar h1 {
      font-size: 1.8rem;
      color: #1A4D2E;
    }

    .topbar-actions {
      display: flex;
      gap: 15px;
    }

    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      font-size: 0.9rem;
    }

    .btn-primary { background: #1A4D2E; color: white; }
    .btn-primary:hover { background: #2d5a3a; transform: translateY(-2px); }
    .btn-success { background: #4CAF50; color: white; }
    .btn-success:hover { background: #45a049; }
    .btn-danger { background: #e74c3c; color: white; }
    .btn-danger:hover { background: #c0392b; }
    .btn-secondary { background: #95a5a6; color: white; }
    .btn-secondary:hover { background: #7f8c8d; }
    .btn-outline { background: none; border: 1px solid #ddd; color: #2d3436; }
    .btn-outline:hover { background: #f5f5f5; }
    .btn-sm { padding: 6px 12px; font-size: 0.8rem; }

    /* TABS */
    .tab-container { background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1); }
    .tab-buttons { display: flex; border-bottom: 1px solid #e0e0e0; background: #fafafa; }
    
    .tab-btn {
      flex: 1;
      padding: 15px 20px;
      background: none;
      border: none;
      border-bottom: 3px solid transparent;
      cursor: pointer;
      font-weight: 600;
      color: #666;
      transition: all 0.3s;
    }

    .tab-btn:hover { color: #1A4D2E; background: #f5f5f5; }
    .tab-btn.active { color: #1A4D2E; border-bottom-color: #1A4D2E; }

    .tab-content { display: none; padding: 30px; animation: fadeIn 0.3s; }
    .tab-content.active { display: block; }

    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

    /* FORMS */
    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      font-weight: 600;
      margin-bottom: 8px;
      color: #2d3436;
    }

    .form-group input,
    .form-group textarea,
    .form-group select {
      width: 100%;
      padding: 12px 15px;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-family: inherit;
      font-size: 0.95rem;
      transition: border-color 0.3s;
    }

    .form-group input:focus,
    .form-group textarea:focus,
    .form-group select:focus {
      outline: none;
      border-color: #1A4D2E;
      box-shadow: 0 0 0 3px rgba(26, 77, 46, 0.1);
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }

    /* CARDS */
    .card {
      background: white;
      padding: 20px;
      border-radius: 12px;
      border: 1px solid #e0e0e0;
      margin-bottom: 20px;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid #e0e0e0;
    }

    .item-list { margin: 20px 0; }

    .item-list-item {
      background: #f9f9f9;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-left: 4px solid #1A4D2E;
    }

    .item-info { flex: 1; }
    .item-title { font-weight: 600; color: #2d3436; margin-bottom: 5px; }
    .item-desc { font-size: 0.9rem; color: #666; }
    .item-actions { display: flex; gap: 8px; }

    /* TOGGLE SWITCH */
    .toggle-switch {
      position: relative;
      width: 50px;
      height: 24px;
      background: #ccc;
      border-radius: 12px;
      cursor: pointer;
      transition: background 0.3s;
    }

    .toggle-switch.active { background: #4CAF50; }

    .toggle-slider {
      position: absolute;
      top: 2px;
      left: 2px;
      width: 20px;
      height: 20px;
      background: white;
      border-radius: 50%;
      transition: left 0.3s;
    }

    .toggle-switch.active .toggle-slider { left: 28px; }

    .visibility-toggle {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    /* RESPONSIVE */
    @media (max-width: 768px) {
      .admin-container { flex-direction: column; }
      .sidebar { width: 100%; height: auto; position: relative; padding: 20px; }
      .main-content { margin-left: 0; padding: 20px; }
      .topbar { flex-direction: column; gap: 15px; text-align: center; }
      .form-row { grid-template-columns: 1fr; }
      .tab-buttons { overflow-x: auto; }
      .tab-btn { white-space: nowrap; }
    }

    .text-center { text-align: center; }
    .mt-20 { margin-top: 20px; }
    .mt-30 { margin-top: 30px; }
    .mb-20 { margin-bottom: 20px; }
    .text-muted { color: #666; }
    
    .admin-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }
    
    .admin-modal-content {
      background: white;
      padding: 30px;
      border-radius: 12px;
      width: 90%;
      max-width: 500px;
      max-height: 80vh;
      overflow-y: auto;
    }
    
    .admin-modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      border-bottom: 1px solid #e0e0e0;
      padding-bottom: 15px;
    }
    
    .admin-modal-close {
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
    }
    
    .u-bg-nav { background: rgba(255,255,255,0.1) !important; }
    .u-w-full { width: 100% !important; }
  </style>
</head>
<body>

<div class="admin-container">
  <!-- SIDEBAR -->
  <div class="sidebar">
    <div class="sidebar-logo">
      <img src="/img/ecostay-logo.png" alt="EcoStay Logo" style="height: 40px; margin-right: 10px;">
      EcoStay CMS
    </div>
    <ul class="sidebar-nav">
      <li><button type="button" class="tab-btn active" onclick="switchTab('general', event)"><i class="fas fa-sliders-h"></i> General</button></li>
      <li><button type="button" class="tab-btn" onclick="switchTab('hero', event)"><i class="fas fa-image"></i> Hero Section</button></li>
      <li><button type="button" class="tab-btn" onclick="switchTab('mission', event)"><i class="fas fa-bullseye"></i> Mission</button></li>
      <li><button type="button" class="tab-btn" onclick="switchTab('impact', event)"><i class="fas fa-chart-line"></i> Impact</button></li>
      <li><button type="button" class="tab-btn" onclick="switchTab('team', event)"><i class="fas fa-users"></i> Team</button></li>
      <li><button type="button" class="tab-btn" onclick="switchTab('testimonials', event)"><i class="fas fa-quote-left"></i> Testimonials</button></li>
      <li><button type="button" class="tab-btn" onclick="switchTab('events', event)"><i class="fas fa-calendar-alt"></i> Events</button></li>
      <li><button type="button" class="tab-btn" onclick="switchTab('history', event)"><i class="fas fa-history"></i> History</button></li>
      <li><button type="button" class="tab-btn" onclick="switchTab('theme', event)"><i class="fas fa-palette"></i> Theme</button></li>
      <li style="margin-top: 30px;"><button type="button" class="tab-btn" onclick="previewSite()" style="background: rgba(255,255,255,0.1);"><i class="fas fa-eye"></i> Preview</button></li>
      <li><button type="button" class="tab-btn" onclick="window.location.href='index.html'" style="background: rgba(255,255,255,0.1);"><i class="fas fa-home"></i> Go to Site</button></li>
    </ul>
  </div>

  <!-- MAIN CONTENT -->
  <div class="main-content">
    <div class="topbar">
      <h1 id="section-title">General Settings</h1>
      <div class="topbar-actions">
        <button class="btn btn-success" onclick="saveAllChanges()"><i class="fas fa-save"></i> Save All</button>
        <button class="btn btn-secondary" onclick="resetToDefaults()"><i class="fas fa-undo"></i> Reset</button>
      </div>
    </div>

    <!-- GENERAL TAB -->
    <div id="general" class="tab-content active">
      <h2>Section Visibility</h2>
      <div class="card">
        <div class="form-group">
          <label class="visibility-toggle">
            <span>Navbar</span>
            <div class="toggle-switch active" id="toggle-navbar" onclick="toggleVisibility(this)">
              <div class="toggle-slider"></div>
            </div>
          </label>
        </div>
        <div class="form-group">
          <label class="visibility-toggle">
            <span>Hero</span>
            <div class="toggle-switch active" id="toggle-hero" onclick="toggleVisibility(this)">
              <div class="toggle-slider"></div>
            </div>
          </label>
        </div>
        <div class="form-group">
          <label class="visibility-toggle">
            <span>Mission</span>
            <div class="toggle-switch active" id="toggle-mission" onclick="toggleVisibility(this)">
              <div class="toggle-slider"></div>
            </div>
          </label>
        </div>
        <div class="form-group">
          <label class="visibility-toggle">
            <span>Impact</span>
            <div class="toggle-switch active" id="toggle-impact" onclick="toggleVisibility(this)">
              <div class="toggle-slider"></div>
            </div>
          </label>
        </div>
        <div class="form-group">
          <label class="visibility-toggle">
            <span>Team</span>
            <div class="toggle-switch active" id="toggle-team" onclick="toggleVisibility(this)">
              <div class="toggle-slider"></div>
            </div>
          </label>
        </div>
        <div class="form-group">
          <label class="visibility-toggle">
            <span>Testimonials</span>
            <div class="toggle-switch active" id="toggle-testimonials" onclick="toggleVisibility(this)">
              <div class="toggle-slider"></div>
            </div>
          </label>
        </div>
        <div class="form-group">
          <label class="visibility-toggle">
            <span>Events</span>
            <div class="toggle-switch active" id="toggle-events" onclick="toggleVisibility(this)">
              <div class="toggle-slider"></div>
            </div>
          </label>
        </div>
        <div class="form-group">
          <label class="visibility-toggle">
            <span>Footer</span>
            <div class="toggle-switch active" id="toggle-footer" onclick="toggleVisibility(this)">
              <div class="toggle-slider"></div>
            </div>
          </label>
        </div>
      </div>
    </div>

    <!-- HERO TAB -->
    <div id="hero" class="tab-content">
      <h2>Hero Section</h2>
      <div class="card">
        <div class="form-group">
          <label>Headline</label>
          <input type="text" id="heroHeadline" placeholder="Enter hero headline">
        </div>
        <div class="form-group">
          <label>Subheading</label>
          <textarea id="heroSubheading" placeholder="Enter hero subheading"></textarea>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>CTA Button Text</label>
            <input type="text" id="heroCtaText" placeholder="Button text">
          </div>
          <div class="form-group">
            <label>CTA Button Link</label>
            <input type="text" id="heroCtaLink" placeholder="#events">
          </div>
        </div>
      </div>
    </div>

    <!-- MISSION TAB -->
    <div id="mission" class="tab-content">
      <h2>Mission & Vision</h2>
      <div class="card">
        <div class="form-group">
          <label>Section Title</label>
          <input type="text" id="missionTitle" placeholder="Our Mission & Vision">
        </div>
        <div class="form-group">
          <label>Subtitle</label>
          <input type="text" id="missionSubtitle" placeholder="Subtitle">
        </div>
        <div class="form-group">
          <label>Mission Text</label>
          <textarea id="missionText" placeholder="Our mission..."></textarea>
        </div>
        <div class="form-group">
          <label>Vision Text</label>
          <textarea id="visionText" placeholder="Our vision..."></textarea>
        </div>
        <div class="form-group">
          <label>Who We Are</label>
          <textarea id="whoWeAre" placeholder="Description..."></textarea>
        </div>
      </div>
    </div>

    <!-- IMPACT TAB -->
    <div id="impact" class="tab-content">
      <h2>Impact Statistics</h2>
      <div class="card">
        <div class="form-group">
          <label>Trees Planted</label>
          <input type="number" id="impactTrees" placeholder="1240">
        </div>
        <div class="form-group">
          <label>Carbon Reduced (kg)</label>
          <input type="number" id="impactCarbon" placeholder="31000">
        </div>
        <div class="form-group">
          <label>Active Members</label>
          <input type="number" id="impactMembers" placeholder="450">
        </div>
      </div>
    </div>

    <!-- TEAM TAB -->
    <div id="team" class="tab-content">
      <h2>Team Members</h2>
      <button class="btn btn-primary" onclick="openTeamModal()" style="margin-bottom: 20px;"><i class="fas fa-plus"></i> Add Member</button>
      <div id="team-members-list" class="item-list"></div>
    </div>

    <!-- TESTIMONIALS TAB -->
    <div id="testimonials" class="tab-content">
      <h2>Testimonials</h2>
      <button class="btn btn-primary" onclick="openTestimonialModal()" style="margin-bottom: 20px;"><i class="fas fa-plus"></i> Add Testimonial</button>
      <div id="testimonials-list" class="item-list"></div>
    </div>

    <!-- EVENTS TAB -->
    <div id="events" class="tab-content">
      <h2>Events</h2>
      <button class="btn btn-primary" onclick="openEventModal()" style="margin-bottom: 20px;"><i class="fas fa-plus"></i> Add Event</button>
      <div id="events-list" class="item-list"></div>
    </div>

    <!-- HISTORY TAB -->
    <div id="history" class="tab-content">
      <h2>History / Timeline</h2>
      <div class="card" style="margin-bottom: 20px;">
        <div class="form-group">
          <label>Section Title</label>
          <input type="text" id="historyTitle" placeholder="Our Journey">
        </div>
      </div>
      <button class="btn btn-primary" onclick="openHistoryModal()" style="margin-bottom: 20px;"><i class="fas fa-plus"></i> Add Milestone</button>
      <div id="history-list" class="item-list"></div>
    </div>

    <!-- THEME TAB -->
    <div id="theme" class="tab-content">
      <h2>Color Theme</h2>
      <div class="card">
        <div class="form-group">
          <label>Primary Color</label>
          <input type="color" id="colorPrimary" onchange="updateTheme()">
          <input type="text" id="colorPrimaryHex" placeholder="#1A4D2E" style="margin-top: 10px;" onchange="updateTheme()">
        </div>
        <div class="form-group">
          <label>Secondary Color</label>
          <input type="color" id="colorSecondary" onchange="updateTheme()">
          <input type="text" id="colorSecondaryHex" placeholder="#4F6F52" style="margin-top: 10px;" onchange="updateTheme()">
        </div>
        <div class="form-group">
          <label>Accent Color</label>
          <input type="color" id="colorAccent" onchange="updateTheme()">
          <input type="text" id="colorAccentHex" placeholder="#FF9F1C" style="margin-top: 10px;" onchange="updateTheme()">
        </div>
      </div>
    </div>
  </div>
</div>

<!-- MODALS -->
<div id="teamModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:1000; align-items:center; justify-content:center;">
  <div style="background:white; padding:30px; border-radius:12px; width:90%; max-width:500px; max-height:80vh; overflow-y:auto;">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; border-bottom:1px solid #e0e0e0; padding-bottom:15px;">
      <h2>Team Member</h2>
      <button onclick="closeModal('teamModal')" style="background:none; border:none; font-size:24px; cursor:pointer;">&times;</button>
    </div>
    <form onsubmit="saveTeamMember(event)">
      <div class="form-group">
        <label>Name</label>
        <input type="text" id="teamName" required>
      </div>
      <div class="form-group">
        <label>Role</label>
        <input type="text" id="teamRole" required>
      </div>
      <div class="form-group">
        <label>Department</label>
        <input type="text" id="teamDept" required>
      </div>
      <div class="form-group">
        <label>Email</label>
        <input type="email" id="teamEmail" required>
      </div>
      <div class="form-group">
        <label>Phone</label>
        <input type="tel" id="teamPhone" required>
      </div>
      <div class="form-group">
        <label>Image URL</label>
        <input type="text" id="teamImage" required>
      </div>
      <button type="submit" class="btn btn-success" style="width:100%; margin-top:20px;">Save</button>
    </form>
  </div>
</div>

<div id="testimonialModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:1000; align-items:center; justify-content:center;">
  <div style="background:white; padding:30px; border-radius:12px; width:90%; max-width:500px; max-height:80vh; overflow-y:auto;">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; border-bottom:1px solid #e0e0e0; padding-bottom:15px;">
      <h2>Testimonial</h2>
      <button onclick="closeModal('testimonialModal')" style="background:none; border:none; font-size:24px; cursor:pointer;">&times;</button>
    </div>
    <form onsubmit="saveTestimonial(event)">
      <div class="form-group">
        <label>Quote</label>
        <textarea id="testiText" required></textarea>
      </div>
      <div class="form-group">
        <label>Author</label>
        <input type="text" id="testiAuthor" required>
      </div>
      <div class="form-group">
        <label>Role</label>
        <input type="text" id="testiRole" required>
      </div>
      <div class="form-group">
        <label>Image URL</label>
        <input type="text" id="testiImage" required>
      </div>
      <button type="submit" class="btn btn-success" style="width:100%; margin-top:20px;">Save</button>
    </form>
  </div>
</div>

<div id="eventModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:1000; align-items:center; justify-content:center;">
  <div style="background:white; padding:30px; border-radius:12px; width:90%; max-width:500px; max-height:80vh; overflow-y:auto;">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; border-bottom:1px solid #e0e0e0; padding-bottom:15px;">
      <h2>Event</h2>
      <button onclick="closeModal('eventModal')" style="background:none; border:none; font-size:24px; cursor:pointer;">&times;</button>
    </div>
    <form onsubmit="saveEvent(event)">
      <div class="form-group">
        <label>Title</label>
        <input type="text" id="eventTitle" required>
      </div>
      <div class="form-group">
        <label>Date</label>
        <input type="text" id="eventDate" placeholder="e.g., OCT 05, 2026" required>
      </div>
      <div class="form-group">
        <label>Location</label>
        <input type="text" id="eventLocation" required>
      </div>
      <div class="form-group">
        <label>Description</label>
        <textarea id="eventDesc" required></textarea>
      </div>
      <div class="form-group">
        <label>Status</label>
        <select id="eventStatus" required>
          <option value="Upcoming">Upcoming</option>
          <option value="Completed">Completed</option>
        </select>
      </div>
      <div class="form-group">
        <label>Image URL</label>
        <input type="text" id="eventImage" required>
      </div>
      <button type="submit" class="btn btn-success" style="width:100%; margin-top:20px;">Save</button>
    </form>
  </div>
</div>

<div id="historyModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:1000; align-items:center; justify-content:center;">
  <div style="background:white; padding:30px; border-radius:12px; width:90%; max-width:500px; max-height:80vh; overflow-y:auto;">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; border-bottom:1px solid #e0e0e0; padding-bottom:15px;">
      <h2>Milestone</h2>
      <button onclick="closeModal('historyModal')" style="background:none; border:none; font-size:24px; cursor:pointer;">&times;</button>
    </div>
    <form onsubmit="saveHistoryItem(event)">
      <div class="form-group">
        <label>Year</label>
        <input type="text" id="histYear" placeholder="e.g., 2024" required>
      </div>
      <div class="form-group">
        <label>Title</label>
        <input type="text" id="histTitle" required>
      </div>
      <div class="form-group">
        <label>Description</label>
        <textarea id="histDesc" required></textarea>
      </div>
      <button type="submit" class="btn btn-success" style="width:100%; margin-top:20px;">Save</button>
    </form>
  </div>
</div>

<script type="module" src="/script-firebase.js"></script>
<script type="module">
let currentEditingId = null;

function switchTab(tabName, event) {
  document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
  document.querySelectorAll('.sidebar-nav button').forEach(btn => btn.classList.remove('active'));
  
  document.getElementById(tabName).classList.add('active');
  if (event && event.target) {
    // If we clicked the icon instead of the button, get the parent button
    const btn = event.target.closest('button');
    if (btn) btn.classList.add('active');
  }
  
  const titles = {
    general: 'General Settings',
    hero: 'Hero Section',
    mission: 'Mission & Vision',
    team: 'Team Management',
    testimonials: 'Testimonials',
    events: 'Events Manager',
    history: 'History & Timeline',
    impact: 'Impact Statistics',
    theme: 'Theme Editor'
  };
  document.getElementById('section-title').textContent = titles[tabName];
  
  loadTabData(tabName);
}

function loadTabData(tabName) {
  const config = getSiteConfig();
  
  if (tabName === 'general') {
    updateToggle('toggle-navbar', config.navbar.visible);
    updateToggle('toggle-hero', config.hero.visible);
    updateToggle('toggle-mission', config.mission.visible);
    updateToggle('toggle-impact', config.impact.visible);
    updateToggle('toggle-team', config.team.visible);
    updateToggle('toggle-testimonials', config.testimonials.visible);
    updateToggle('toggle-events', config.events.visible);
    updateToggle('toggle-footer', config.footer.visible);
  } else if (tabName === 'hero') {
    document.getElementById('heroHeadline').value = config.hero.headline;
    document.getElementById('heroSubheading').value = config.hero.subheading;
    document.getElementById('heroCtaText').value = config.hero.ctaButtonText;
    document.getElementById('heroCtaLink').value = config.hero.ctaButtonLink;
  } else if (tabName === 'mission') {
    document.getElementById('missionTitle').value = config.mission.title;
    document.getElementById('missionSubtitle').value = config.mission.subtitle;
    document.getElementById('missionText').value = config.mission.missionText;
    document.getElementById('visionText').value = config.mission.visionText;
    document.getElementById('whoWeAre').value = config.mission.whoWeAre;
  } else if (tabName === 'history') {
    document.getElementById('historyTitle').value = config.history.title;
    loadHistoryList(config);
  } else if (tabName === 'impact') {
    const trees = config.impact.stats.find(s => s.label.includes('Trees'))?.value || 0;
    const carbon = config.impact.stats.find(s => s.label.includes('CO'))?.value || 0;
    const members = config.impact.stats.find(s => s.label.includes('Members'))?.value || 0;
    document.getElementById('impactTrees').value = trees;
    document.getElementById('impactCarbon').value = carbon;
    document.getElementById('impactMembers').value = members;
  } else if (tabName === 'team') {
    loadTeamList(config);
  } else if (tabName === 'testimonials') {
    loadTestimonialsList(config);
  } else if (tabName === 'events') {
    loadEventsList(config);
  } else if (tabName === 'theme') {
    document.getElementById('colorPrimary').value = config.theme.primaryColor;
    document.getElementById('colorPrimaryHex').value = config.theme.primaryColor;
    document.getElementById('colorSecondary').value = config.theme.secondaryColor;
    document.getElementById('colorSecondaryHex').value = config.theme.secondaryColor;
    document.getElementById('colorAccent').value = config.theme.accentColor;
    document.getElementById('colorAccentHex').value = config.theme.accentColor;
  }
}

function updateToggle(id, state) {
  const toggle = document.getElementById(id);
  if (state) {
    toggle.classList.add('active');
  } else {
    toggle.classList.remove('active');
  }
}

function toggleVisibility(element) {
  element.classList.toggle('active');
}

function updateTheme() {
  const p = document.getElementById('colorPrimary').value;
  const s = document.getElementById('colorSecondary').value;
  const a = document.getElementById('colorAccent').value;
  document.getElementById('colorPrimaryHex').value = p;
  document.getElementById('colorSecondaryHex').value = s;
  document.getElementById('colorAccentHex').value = a;
}

function loadTeamList(config) {
  let html = '';
  config.team.members.forEach((member, idx) => {
    html += `<div class="item-list-item">
      <div class="item-info">
        <div class="item-title">${member.name}</div>
        <div class="item-desc">${member.role} - ${member.department || member.dept || ''}</div>
      </div>
      <div class="item-actions">
        <button class="btn btn-sm btn-outline" onclick="editTeamMember(${idx})"><i class="fas fa-edit"></i></button>
        <button class="btn btn-sm btn-danger" onclick="deleteTeamMember(${idx})"><i class="fas fa-trash"></i></button>
      </div>
    </div>`;
  });
  document.getElementById('team-members-list').innerHTML = html;
}

function loadTestimonialsList(config) {
  let html = '';
  config.testimonials.items.forEach((item, idx) => {
    html += `<div class="item-list-item">
      <div class="item-info">
        <div class="item-title">"${item.text.substring(0, 50)}..."</div>
        <div class="item-desc">- ${item.author}</div>
      </div>
      <div class="item-actions">
        <button class="btn btn-sm btn-outline" onclick="editTestimonial(${idx})"><i class="fas fa-edit"></i></button>
        <button class="btn btn-sm btn-danger" onclick="deleteTestimonial(${idx})"><i class="fas fa-trash"></i></button>
      </div>
    </div>`;
  });
  document.getElementById('testimonials-list').innerHTML = html;
}

function loadEventsList(config) {
  let html = '';
  config.events.items.forEach((event, idx) => {
    html += `<div class="item-list-item">
      <div class="item-info">
        <div class="item-title">${event.title}</div>
        <div class="item-desc">${event.date} - ${event.location}</div>
      </div>
      <div class="item-actions">
        <button class="btn btn-sm btn-outline" onclick="editEvent(${idx})"><i class="fas fa-edit"></i></button>
        <button class="btn btn-sm btn-danger" onclick="deleteEvent(${idx})"><i class="fas fa-trash"></i></button>
      </div>
    </div>`;
  });
  document.getElementById('events-list').innerHTML = html;
}

function loadHistoryList(config) {
  let html = '';
  config.history.items.forEach((item, idx) => {
    html += `<div class="item-list-item">
      <div class="item-info">
        <div class="item-title">${item.year}: ${item.title}</div>
        <div class="item-desc">${item.description || item.desc || ''}</div>
      </div>
      <div class="item-actions">
        <button class="btn btn-sm btn-outline" onclick="editHistoryItem(${idx})"><i class="fas fa-edit"></i></button>
        <button class="btn btn-sm btn-danger" onclick="deleteHistoryItem(${idx})"><i class="fas fa-trash"></i></button>
      </div>
    </div>`;
  });
  document.getElementById('history-list').innerHTML = html;
}

function openTeamModal() {
  currentEditingId = null;
  document.getElementById('teamName').value = '';
  document.getElementById('teamRole').value = '';
  document.getElementById('teamDept').value = '';
  document.getElementById('teamEmail').value = '';
  document.getElementById('teamPhone').value = '';
  document.getElementById('teamImage').value = '';
  document.getElementById('teamModal').style.display = 'flex';
}

function editTeamMember(idx) {
  const config = getSiteConfig();
  const member = config.team.members[idx];
  currentEditingId = idx;
  document.getElementById('teamName').value = member.name;
  document.getElementById('teamRole').value = member.role;
  document.getElementById('teamDept').value = member.department || member.dept || '';
  document.getElementById('teamEmail').value = member.email;
  document.getElementById('teamPhone').value = member.phone;
  document.getElementById('teamImage').value = member.image;
  document.getElementById('teamModal').style.display = 'flex';
}

function deleteTeamMember(idx) {
  if (confirm('Delete this team member?')) {
    const config = getSiteConfig();
    config.team.members.splice(idx, 1);
    saveSiteConfig(config);
    loadTeamList(config);
  }
}

function saveTeamMember(e) {
  e.preventDefault();
  const config = getSiteConfig();
  const member = {
    id: currentEditingId !== null ? config.team.members[currentEditingId].id : Date.now(),
    name: document.getElementById('teamName').value,
    role: document.getElementById('teamRole').value,
    department: document.getElementById('teamDept').value,
    email: document.getElementById('teamEmail').value,
    phone: document.getElementById('teamPhone').value,
    image: document.getElementById('teamImage').value,
    visible: true
  };
  
  if (currentEditingId !== null) {
    config.team.members[currentEditingId] = member;
  } else {
    config.team.members.push(member);
  }
  saveSiteConfig(config);
  loadTeamList(config);
  closeModal('teamModal');
}

function openTestimonialModal() {
  currentEditingId = null;
  document.getElementById('testiText').value = '';
  document.getElementById('testiAuthor').value = '';
  document.getElementById('testiRole').value = '';
  document.getElementById('testiImage').value = '';
  document.getElementById('testimonialModal').style.display = 'flex';
}

function editTestimonial(idx) {
  const config = getSiteConfig();
  const testi = config.testimonials.items[idx];
  currentEditingId = idx;
  document.getElementById('testiText').value = testi.text;
  document.getElementById('testiAuthor').value = testi.author;
  document.getElementById('testiRole').value = testi.role;
  document.getElementById('testiImage').value = testi.image;
  document.getElementById('testimonialModal').style.display = 'flex';
}

function deleteTestimonial(idx) {
  if (confirm('Delete this testimonial?')) {
    const config = getSiteConfig();
    config.testimonials.items.splice(idx, 1);
    saveSiteConfig(config);
    loadTestimonialsList(config);
  }
}

function saveTestimonial(e) {
  e.preventDefault();
  const config = getSiteConfig();
  const testi = {
    id: currentEditingId !== null ? config.testimonials.items[currentEditingId].id : Date.now(),
    text: document.getElementById('testiText').value,
    author: document.getElementById('testiAuthor').value,
    role: document.getElementById('testiRole').value,
    image: document.getElementById('testiImage').value,
    visible: true
  };
  
  if (currentEditingId !== null) {
    config.testimonials.items[currentEditingId] = testi;
  } else {
    config.testimonials.items.push(testi);
  }
  saveSiteConfig(config);
  loadTestimonialsList(config);
  closeModal('testimonialModal');
}

function openEventModal() {
  currentEditingId = null;
  document.getElementById('eventTitle').value = '';
  document.getElementById('eventDate').value = '';
  document.getElementById('eventLocation').value = '';
  document.getElementById('eventDesc').value = '';
  document.getElementById('eventStatus').value = 'Upcoming';
  document.getElementById('eventImage').value = '';
  document.getElementById('eventModal').style.display = 'flex';
}

function editEvent(idx) {
  const config = getSiteConfig();
  const event = config.events.items[idx];
  currentEditingId = idx;
  document.getElementById('eventTitle').value = event.title;
  document.getElementById('eventDate').value = event.date;
  document.getElementById('eventLocation').value = event.location;
  document.getElementById('eventDesc').value = event.description;
  document.getElementById('eventStatus').value = event.status;
  document.getElementById('eventImage').value = event.image;
  document.getElementById('eventModal').style.display = 'flex';
}

function deleteEvent(idx) {
  if (confirm('Delete this event?')) {
    const config = getSiteConfig();
    config.events.items.splice(idx, 1);
    saveSiteConfig(config);
    loadEventsList(config);
  }
}

function saveEvent(e) {
  e.preventDefault();
  const config = getSiteConfig();
  const event = {
    id: currentEditingId !== null ? config.events.items[currentEditingId].id : Date.now(),
    title: document.getElementById('eventTitle').value,
    date: document.getElementById('eventDate').value,
    location: document.getElementById('eventLocation').value,
    description: document.getElementById('eventDesc').value,
    status: document.getElementById('eventStatus').value,
    image: document.getElementById('eventImage').value,
    impact: '',
    visible: true
  };
  
  if (currentEditingId !== null) {
    config.events.items[currentEditingId] = event;
  } else {
    config.events.items.push(event);
  }
  saveSiteConfig(config);
  loadEventsList(config);
  closeModal('eventModal');
}

function openHistoryModal() {
  currentEditingId = null;
  document.getElementById('histYear').value = '';
  document.getElementById('histTitle').value = '';
  document.getElementById('histDesc').value = '';
  document.getElementById('historyModal').style.display = 'flex';
}

function editHistoryItem(idx) {
  const config = getSiteConfig();
  const item = config.history.items[idx];
  currentEditingId = idx;
  document.getElementById('histYear').value = item.year;
  document.getElementById('histTitle').value = item.title;
  document.getElementById('histDesc').value = item.description || item.desc || '';
  document.getElementById('historyModal').style.display = 'flex';
}

function deleteHistoryItem(idx) {
  if (confirm('Delete this milestone?')) {
    const config = getSiteConfig();
    config.history.items.splice(idx, 1);
    saveSiteConfig(config);
    loadHistoryList(config);
  }
}

function saveHistoryItem(e) {
  e.preventDefault();
  const config = getSiteConfig();
  const item = {
    id: currentEditingId !== null ? config.history.items[currentEditingId].id : Date.now(),
    year: document.getElementById('histYear').value,
    title: document.getElementById('histTitle').value,
    description: document.getElementById('histDesc').value
  };
  
  if (currentEditingId !== null) {
    config.history.items[currentEditingId] = item;
  } else {
    config.history.items.push(item);
  }
  saveSiteConfig(config);
  loadHistoryList(config);
  closeModal('historyModal');
}

function closeModal(modalId) {
  document.getElementById(modalId).style.display = 'none';
}

async function saveAllChanges() {
  const config = getSiteConfig();
  
  config.hero.headline = document.getElementById('heroHeadline').value;
  config.hero.subheading = document.getElementById('heroSubheading').value;
  config.hero.ctaButtonText = document.getElementById('heroCtaText').value;
  config.hero.ctaButtonLink = document.getElementById('heroCtaLink').value;
  
  config.mission.title = document.getElementById('missionTitle').value;
  config.mission.subtitle = document.getElementById('missionSubtitle').value;
  config.mission.missionText = document.getElementById('missionText').value;
  config.mission.visionText = document.getElementById('visionText').value;
  config.mission.whoWeAre = document.getElementById('whoWeAre').value;
  
  config.history.title = document.getElementById('historyTitle').value;
  
  config.impact.stats = [
    { label: "Trees Planted", value: parseInt(document.getElementById('impactTrees').value) || 0, icon: "fa-tree" },
    { label: "COâ‚‚ Offset (kg)", value: parseInt(document.getElementById('impactCarbon').value) || 0, icon: "fa-leaf" },
    { label: "Active Members", value: parseInt(document.getElementById('impactMembers').value) || 0, icon: "fa-users" }
  ];
  
  config.navbar.visible = document.getElementById('toggle-navbar').classList.contains('active');
  config.hero.visible = document.getElementById('toggle-hero').classList.contains('active');
  config.mission.visible = document.getElementById('toggle-mission').classList.contains('active');
  config.impact.visible = document.getElementById('toggle-impact').classList.contains('active');
  config.team.visible = document.getElementById('toggle-team').classList.contains('active');
  config.testimonials.visible = document.getElementById('toggle-testimonials').classList.contains('active');
  config.events.visible = document.getElementById('toggle-events').classList.contains('active');
  config.footer.visible = document.getElementById('toggle-footer').classList.contains('active');
  
  config.theme.primaryColor = document.getElementById('colorPrimary').value;
  config.theme.secondaryColor = document.getElementById('colorSecondary').value;
  config.theme.accentColor = document.getElementById('colorAccent').value;
  
  await saveSiteConfig(config);
}

async function resetToDefaults() {
  if (confirm('Reset all to default? This cannot be undone.')) {
    await resetSiteConfig();
    location.reload();
  }
}

async function previewSite() {
  await saveAllChanges();
  window.open('index.html', '_blank');
}

// Expose functions to window
window.switchTab = switchTab;
window.loadTabData = loadTabData;
window.updateToggle = updateToggle;
window.toggleVisibility = toggleVisibility;
window.updateTheme = updateTheme;
window.loadTeamList = loadTeamList;
window.loadTestimonialsList = loadTestimonialsList;
window.loadEventsList = loadEventsList;
window.loadHistoryList = loadHistoryList;
window.openTeamModal = openTeamModal;
window.editTeamMember = editTeamMember;
window.deleteTeamMember = deleteTeamMember;
window.saveTeamMember = saveTeamMember;
window.openTestimonialModal = openTestimonialModal;
window.editTestimonial = editTestimonial;
window.deleteTestimonial = deleteTestimonial;
window.saveTestimonial = saveTestimonial;
window.openEventModal = openEventModal;
window.editEvent = editEvent;
window.deleteEvent = deleteEvent;
window.saveEvent = saveEvent;
window.openHistoryModal = openHistoryModal;
window.editHistoryItem = editHistoryItem;
window.deleteHistoryItem = deleteHistoryItem;
window.saveHistoryItem = saveHistoryItem;
window.closeModal = closeModal;
window.saveAllChanges = saveAllChanges;
window.resetToDefaults = resetToDefaults;
window.previewSite = previewSite;

document.addEventListener('DOMContentLoaded', async () => {
  // Wait a bit for the other module to initialize if needed
  // though deferred scripts run in order, so this should be fine.
  loadTabData('general');
});
</script>

</body>
</html>
