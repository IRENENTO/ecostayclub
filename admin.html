<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EcoStay Club - Admin Dashboard</title>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #1a472a;
            --primary-light: #2d5a3f;
            --secondary: #4CAF50;
            --text: #333;
            --light: #f8f9fa;
            --dark: #212529;
            --gray: #6c757d;
            --light-gray: #e9ecef;
            --border: #dee2e6;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            color: var(--text);
            line-height: 1.6;
        }
        
        .dashboard {
            display: flex;
            min-height: 100vh;
        }
        
        /* Sidebar */
        .sidebar {
            width: 250px;
            background: var(--primary);
            color: white;
            padding: 1.5rem 0;
            position: fixed;
            height: 100%;
            overflow-y: auto;
        }
        
        .logo {
            text-align: center;
            padding: 0 1rem 1.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 1.5rem;
        }
        
        .logo img {
            max-width: 120px;
            height: auto;
        }
        
        .nav-menu {
            padding: 0 1rem;
        }
        
        .nav-item {
            margin-bottom: 0.5rem;
        }
        
        .nav-link {
            display: flex;
            align-items: center;
            padding: 0.75rem 1rem;
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            border-radius: 6px;
            transition: all 0.3s ease;
        }
        
        .nav-link:hover, .nav-link.active {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }
        
        .nav-link i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }
        
        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: 250px;
            padding: 2rem;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border);
        }
        
        .page-title h1 {
            font-size: 1.75rem;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }
        
        .user-menu {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .notification-icon {
            position: relative;
            color: var(--gray);
            font-size: 1.25rem;
            cursor: pointer;
        }
        
        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--secondary);
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .user-profile {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--light-gray);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: var(--primary);
        }
        
        .user-info h4 {
            font-size: 0.9rem;
            margin-bottom: 0.2rem;
        }
        
        .user-info p {
            font-size: 0.8rem;
            color: var(--gray);
        }
        
        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
        }
        
        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
        }
        
        .stat-icon.members { background: #4e73df; }
        .stat-icon.events { background: #1cc88a; }
        .stat-icon.donations { background: #f6c23e; }
        .stat-icon.activities { background: #e74a3b; }
        
        .stat-value {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--dark);
            margin: 0.5rem 0;
        }
        
        .stat-label {
            color: var(--gray);
            font-size: 0.9rem;
        }
        
        .stat-change {
            display: flex;
            align-items: center;
            font-size: 0.85rem;
            margin-top: 0.5rem;
        }
        
        .stat-change.positive {
            color: #1cc88a;
        }
        
        .stat-change.negative {
            color: #e74a3b;
        }
        
        /* Charts */
        .charts-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .chart-card {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }
        
        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        
        .chart-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--dark);
        }
        
        .chart-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .chart-btn {
            background: none;
            border: 1px solid var(--border);
            border-radius: 4px;
            padding: 0.25rem 0.75rem;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .chart-btn:hover, .chart-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }
        
        /* Recent Activity */
        .activity-card {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }
        
        .activity-list {
            list-style: none;
        }
        
        .activity-item {
            display: flex;
            align-items: flex-start;
            padding: 1rem 0;
            border-bottom: 1px solid var(--light-gray);
        }
        
        .activity-item:last-child {
            border-bottom: none;
        }
        
        .activity-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--light-gray);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 1rem;
            flex-shrink: 0;
            color: var(--primary);
        }
        
        .activity-content {
            flex: 1;
        }
        
        .activity-title {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }
        
        .activity-desc {
            font-size: 0.9rem;
            color: var(--gray);
            margin-bottom: 0.25rem;
        }
        
        .activity-time {
            font-size: 0.8rem;
            color: var(--gray);
        }
        
        /* Responsive */
        @media (max-width: 1200px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 992px) {
            .sidebar {
                width: 80px;
                overflow: hidden;
            }
            
            .sidebar .logo span,
            .sidebar .nav-link span {
                display: none;
            }
            
            .sidebar .nav-link {
                justify-content: center;
                padding: 0.75rem;
            }
            
            .sidebar .nav-link i {
                margin-right: 0;
                font-size: 1.2rem;
            }
            
            .main-content {
                margin-left: 80px;
            }
        }
        
        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr 1fr;
            }
            
            .user-info {
                display: none;
            }
        }
        
        @media (max-width: 576px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .header {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }
            
            .user-menu {
                width: 100%;
                justify-content: space-between;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="logo">
                <img src="img/ecostay-logo.png" alt="EcoStay Admin">
            </div>
            <nav class="nav-menu">
                <div class="nav-item">
                    <a href="#" class="nav-link active" onclick="switchView('dashboard', event)">
                        <i class="fas fa-tachometer-alt"></i>
                        <span>Dashboard</span>
                    </a>
                </div>
                <div class="nav-item">
                    <a href="#" class="nav-link" onclick="switchView('members', event)">
                        <i class="fas fa-users"></i>
                        <span>Members</span>
                    </a>
                </div>
                <div class="nav-item">
                    <a href="#" class="nav-link" onclick="switchView('content', event)">
                        <i class="fas fa-edit"></i>
                        <span>Edit Site</span>
                    </a>
                </div>
                <div class="nav-item">
                    <a href="#" class="nav-link" onclick="switchView('team', event)">
                        <i class="fas fa-user-friends"></i>
                        <span>Manage Team</span>
                    </a>
                </div>
                <div class="nav-item">
                    <a href="#" class="nav-link" onclick="switchView('history', event)">
                        <i class="fas fa-history"></i>
                        <span>Manage History</span>
                    </a>
                </div>
                <div class="nav-item">
                    <a href="#" class="nav-link" onclick="switchView('events', event)">
                        <i class="fas fa-calendar-alt"></i>
                        <span>Manage Events</span>
                    </a>
                </div>
                <div class="nav-item">
                    <a href="#" class="nav-link" onclick="switchView('donations', event)">
                        <i class="fas fa-hand-holding-usd"></i>
                        <span>Donations</span>
                    </a>
                </div>
                <div class="nav-item">
                    <a href="#" class="nav-link" onclick="switchView('testimonials', event)">
                        <i class="fas fa-quote-left"></i>
                        <span>Testimonials</span>
                    </a>
                </div>
                <div class="nav-item">
                    <a href="#" class="nav-link" onclick="switchView('dashboard', event)">
                        <i class="fas fa-chart-line"></i>
                        <span>Analytics</span>
                    </a>
                </div>
                <div class="nav-item">
                    <a href="#" class="nav-link" onclick="logoutAdmin()">
                        <i class="fas fa-sign-out-alt"></i>
                        <span>Logout</span>
                    </a>
                </div>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <div class="header">
                <div class="page-title">
                    <h1>Dashboard</h1>
                    <p>Welcome back, Admin</p>
                </div>
                <div class="user-menu">
                    <div class="notification-icon">
                        <i class="far fa-bell"></i>
                        <span class="notification-badge">3</span>
                    </div>
                    <div class="user-profile">
                        <div class="user-avatar">
                            <i class="fas fa-user"></i>
                        </div>
                        <div class="user-info">
                            <h4>Admin User</h4>
                            <p>Administrator</p>
                        </div>
                        <i class="fas fa-chevron-down" style="font-size: 0.8rem; color: var(--gray);"></i>
                    </div>
                </div>
            </div>

            <div id="dashboard-view" class="view-section">
                <!-- Stats Cards -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-header">
                            <div>
                                <div class="stat-label">Total Members</div>
                                <div id="admin-stat-members" class="stat-value">--</div>
                            </div>
                            <div class="stat-icon members">
                                <i class="fas fa-users"></i>
                            </div>
                        </div>
                    </div>

                    <div id="stat-trees-card" class="stat-card">
                        <div class="stat-header">
                            <div>
                                <div class="stat-label">Trees Planted</div>
                                <div id="admin-stat-trees" class="stat-value">--</div>
                            </div>
                            <div class="stat-icon events">
                                <i class="fas fa-tree"></i>
                            </div>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <div>
                                <div class="stat-label">Total Donations</div>
                                <div class="stat-value">$12,450</div>
                            </div>
                            <div class="stat-icon donations">
                                <i class="fas fa-hand-holding-usd"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Charts -->
                <div class="charts-grid">
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3 class="chart-title">Members Growth</h3>
                        </div>
                        <div class="chart-container">
                            <canvas id="membersChart"></canvas>
                        </div>
                    </div>

                    <div class="chart-card">
                        <div class="chart-header">
                            <h3 class="chart-title">Event Participation</h3>
                        </div>
                        <div class="chart-container">
                            <canvas id="eventsChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <div id="members-view" class="view-section" style="display: none;">
                <div class="chart-card">
                    <div class="chart-header">
                        <h3 class="chart-title">Registered Members</h3>
                    </div>
                    <div style="overflow-x: auto;">
                        <table style="width: 100%; border-collapse: collapse; margin-top: 1rem;">
                            <thead>
                                <tr style="text-align: left; border-bottom: 2px solid var(--border);">
                                    <th style="padding: 12px;">Name</th>
                                    <th style="padding: 12px;">Email</th>
                                    <th style="padding: 12px;">Role</th>
                                    <th style="padding: 12px;">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="members-table-body">
                                <!-- Users will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="content-view" class="view-section" style="display: none;">
                <div class="chart-card">
                    <div class="chart-header">
                        <h3 class="chart-title">Edit Site Content</h3>
                    </div>
                    <form id="edit-site-data-form">
                        <h4 style="margin-top: 1rem; color: var(--primary);">Impact Statistics</h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem; margin-top: 10px;">
                            <div>
                                <label style="display: block; font-size: 0.8rem;">Trees Planted</label>
                                <input type="number" id="edit-trees" style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 4px;">
                            </div>
                            <div>
                                <label style="display: block; font-size: 0.8rem;">CO2 Saved (kg)</label>
                                <input type="number" id="edit-carbon" style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 4px;">
                            </div>
                            <div>
                                <label style="display: block; font-size: 0.8rem;">Active Members</label>
                                <input type="number" id="edit-members-count" style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 4px;">
                            </div>
                        </div>

                        <h4 style="margin-top: 2rem; color: var(--primary);">Who We Are & Vision</h4>
                        <div style="margin-top: 10px;">
                            <label style="display: block; font-size: 0.8rem;">Who We Are Description</label>
                            <textarea id="edit-who-text" style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 4px; height: 80px; margin-bottom: 10px;"></textarea>

                            <label style="display: block; font-size: 0.8rem;">Vision Text</label>
                            <textarea id="edit-vision-text" style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 4px; height: 60px;"></textarea>
                        </div>

                        <h4 style="margin-top: 2rem; color: var(--primary);">Footer Contact Info</h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-top: 10px;">
                            <div>
                                <label style="display: block; font-size: 0.8rem;">Contact Email</label>
                                <input type="email" id="edit-footer-email" style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 4px;">
                            </div>
                            <div>
                                <label style="display: block; font-size: 0.8rem;">Contact Phone</label>
                                <input type="text" id="edit-footer-phone" style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 4px;">
                            </div>
                            <div style="grid-column: span 2;">
                                <label style="display: block; font-size: 0.8rem;">Office Address</label>
                                <input type="text" id="edit-footer-address" style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 4px;">
                            </div>
                        </div>

                        <button type="submit" style="margin-top: 2rem; background: var(--primary); color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer;">Save All Changes</button>
                    </form>
                </div>
            </div>

            <div id="history-view" class="view-section" style="display: none;">
                <div class="chart-card">
                    <div class="chart-header">
                        <h3 class="chart-title">Manage Our History</h3>
                    </div>
                    <form id="add-history-form" style="margin-bottom: 2rem; background: var(--light); padding: 1rem; border-radius: 8px;">
                        <h4 style="margin-bottom: 10px;">Add Milestone</h4>
                        <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 1rem;">
                            <input type="text" id="history-year" placeholder="Year (e.g. 2024)" required style="padding: 8px; border: 1px solid var(--border); border-radius: 4px;">
                            <input type="text" id="history-title" placeholder="Milestone Title" required style="padding: 8px; border: 1px solid var(--border); border-radius: 4px;">
                            <textarea id="history-desc" placeholder="Description" required style="grid-column: span 2; padding: 8px; border: 1px solid var(--border); border-radius: 4px;"></textarea>
                        </div>
                        <button type="submit" style="margin-top: 1rem; background: var(--secondary); color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;">Add Milestone</button>
                    </form>
                    <div style="overflow-x: auto;">
                        <table style="width: 100%; border-collapse: collapse;">
                            <thead>
                                <tr style="text-align: left; border-bottom: 2px solid var(--border);">
                                    <th style="padding: 12px;">Year</th>
                                    <th style="padding: 12px;">Title</th>
                                    <th style="padding: 12px;">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="history-table-body"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="team-view" class="view-section" style="display: none;">
                <div class="chart-card">
                    <div class="chart-header">
                        <h3 class="chart-title">Manage Team Members</h3>
                    </div>
                    <form id="add-team-form" style="margin-bottom: 2rem; background: var(--light); padding: 1.5rem; border-radius: 12px; border: 1px solid var(--border);">
                        <h4 style="margin-bottom: 15px; color: var(--primary);">Add/Edit Member</h4>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                            <input type="text" id="team-name" placeholder="Full Name" required style="padding: 10px; border: 1px solid var(--border); border-radius: 6px;">
                            <input type="text" id="team-role" placeholder="Role (e.g. President)" required style="padding: 10px; border: 1px solid var(--border); border-radius: 6px;">
                            <input type="text" id="team-dept" placeholder="Department/School" required style="padding: 10px; border: 1px solid var(--border); border-radius: 6px;">
                            <input type="text" id="team-image" placeholder="Image URL" required style="padding: 10px; border: 1px solid var(--border); border-radius: 6px;">
                            <input type="text" id="team-phone" placeholder="Phone" style="padding: 10px; border: 1px solid var(--border); border-radius: 6px;">
                            <input type="email" id="team-email" placeholder="Email" style="padding: 10px; border: 1px solid var(--border); border-radius: 6px;">
                        </div>
                        <div style="margin-top: 1rem; display: flex; gap: 10px;">
                            <button type="submit" style="background: var(--primary); color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer;">Save Member</button>
                            <button type="button" onclick="resetTeamForm()" style="background: var(--gray); color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer;">Cancel</button>
                        </div>
                    </form>
                    
                    <div id="admin-team-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px;">
                        <!-- Team Cards will be injected here -->
                    </div>
                </div>
            </div>

            <div id="events-view" class="view-section" style="display: none;">
                <div class="chart-card">
                    <div class="chart-header">
                        <h3 class="chart-title">Manage Events</h3>
                    </div>
                    <form id="add-event-form" style="margin-bottom: 2rem; background: var(--light); padding: 1.5rem; border-radius: 12px; border: 1px solid var(--border);">
                        <h4 style="margin-bottom: 15px; color: var(--primary);">Add/Edit Event</h4>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                            <input type="text" id="event-title" placeholder="Event Title" required style="padding: 10px; border: 1px solid var(--border); border-radius: 6px;">
                            <input type="text" id="event-date" placeholder="Date (e.g. OCT 05)" required style="padding: 10px; border: 1px solid var(--border); border-radius: 6px;">
                            <input type="text" id="event-location" placeholder="Location" required style="padding: 10px; border: 1px solid var(--border); border-radius: 6px;">
                            <select id="event-status" style="padding: 10px; border: 1px solid var(--border); border-radius: 6px;">
                                <option value="Upcoming">Upcoming</option>
                                <option value="Completed">Completed</option>
                            </select>
                            <input type="text" id="event-image" placeholder="Image URL" style="padding: 10px; border: 1px solid var(--border); border-radius: 6px;">
                        </div>
                        <textarea id="event-desc" placeholder="Short Description" style="width: 100%; margin-top: 1rem; padding: 10px; border: 1px solid var(--border); border-radius: 6px; height: 80px;"></textarea>
                        <div style="margin-top: 1rem; display: flex; gap: 10px;">
                            <button type="submit" style="background: var(--primary); color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer;">Save Event</button>
                            <button type="button" onclick="resetEventForm()" style="background: var(--gray); color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer;">Cancel</button>
                        </div>
                    </form>

                    <div id="admin-events-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px;">
                        <!-- Event Cards will be injected here -->
                    </div>
                </div>
            </div>

            <div id="donations-view" class="view-section" style="display: none;">
                <div class="chart-card">
                    <div class="chart-header">
                        <h3 class="chart-title">Recent Donations</h3>
                    </div>
                    <div style="overflow-x: auto;">
                        <table style="width: 100%; border-collapse: collapse;">
                            <thead>
                                <tr style="text-align: left; border-bottom: 2px solid var(--border);">
                                    <th style="padding: 12px;">Donor</th>
                                    <th style="padding: 12px;">Amount</th>
                                    <th style="padding: 12px;">Method</th>
                                    <th style="padding: 12px;">Date</th>
                                </tr>
                            </thead>
                            <tbody id="donations-table-body">
                                <tr>
                                    <td style="padding: 12px;">John Doe</td>
                                    <td style="padding: 12px;">5,000 RWF</td>
                                    <td style="padding: 12px;">Momo</td>
                                    <td style="padding: 12px;">Jan 12, 2026</td>
                                </tr>
                                <tr>
                                    <td style="padding: 12px;">Jane Smith</td>
                                    <td style="padding: 12px;">10,000 RWF</td>
                                    <td style="padding: 12px;">Momo</td>
                                    <td style="padding: 12px;">Jan 10, 2026</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="testimonials-view" class="view-section" style="display: none;">
                <div class="chart-card">
                    <div class="chart-header">
                        <h3 class="chart-title">Manage Testimonials</h3>
                    </div>
                    <form id="add-testi-form" style="margin-bottom: 2rem; background: var(--light); padding: 1rem; border-radius: 8px;">
                        <h4 style="margin-bottom: 10px;">Add New Testimonial</h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                            <input type="text" id="testi-name" placeholder="Author Name" required style="padding: 8px; border: 1px solid var(--border); border-radius: 4px;">
                            <input type="text" id="testi-role" placeholder="Author Role" required style="padding: 8px; border: 1px solid var(--border); border-radius: 4px;">
                            <input type="text" id="testi-image" placeholder="Image Path" style="padding: 8px; border: 1px solid var(--border); border-radius: 4px;">
                            <textarea id="testi-text" placeholder="Testimonial Quote" required style="grid-column: span 2; padding: 8px; border: 1px solid var(--border); border-radius: 4px;"></textarea>
                        </div>
                        <button type="submit" style="margin-top: 1rem; background: var(--secondary); color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;">Add Testimonial</button>
                    </form>
                    <div style="overflow-x: auto;">
                        <table style="width: 100%; border-collapse: collapse;">
                            <thead>
                                <tr style="text-align: left; border-bottom: 2px solid var(--border);">
                                    <th style="padding: 12px;">Name</th>
                                    <th style="padding: 12px;">Quote</th>
                                    <th style="padding: 12px;">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="testi-table-body"></tbody>
                        </table>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <script>
        // Security Check
        if (localStorage.getItem('ecostay_admin') !== 'true') {
            window.location.href = 'index.html';
        }

        function logoutAdmin() {
            localStorage.removeItem('ecostay_admin');
            window.location.href = 'index.html';
        }

        // Data Management
        let editTeamIndex = -1;
        let editEventIndex = -1;
        let editTestiIndex = -1;
        let editHistoryIndex = -1;

        function getSiteData() {
            return JSON.parse(localStorage.getItem('ecostay_site_data')) || {};
        }

        function getUsers() {
            return JSON.parse(localStorage.getItem('ecostay_users') || '[]');
        }

        function switchView(viewId, event) {
            const viewElement = document.getElementById(viewId + '-view');
            if (!viewElement) {
                console.warn(`View ${viewId}-view not found.`);
                // Fallback to dashboard if view doesn't exist
                if (viewId !== 'dashboard') switchView('dashboard');
                return;
            }

            document.querySelectorAll('.view-section').forEach(section => {
                section.style.display = 'none';
            });
            viewElement.style.display = 'block';

            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            
            // Set active link
            if (event && event.currentTarget) {
                event.currentTarget.classList.add('active');
            } else {
                // Try to find the link by viewId if event is missing
                const links = document.querySelectorAll('.nav-link');
                links.forEach(link => {
                    if (link.getAttribute('onclick') && link.getAttribute('onclick').includes(`'${viewId}'`)) {
                        link.classList.add('active');
                    }
                });
            }

            // Load data for specific views
            if (viewId === 'dashboard') loadAdminStats();
            if (viewId === 'members') loadMembers();
            if (viewId === 'content') loadContentForm();
            if (viewId === 'team') loadTeamList();
            if (viewId === 'history') loadHistoryList();
            if (viewId === 'events') loadEventsList();
            if (viewId === 'donations') loadDonationsList();
            if (viewId === 'testimonials') loadTestimonialsList();

            // Update page title
            const title = document.querySelector('.page-title h1');
            if (title) {
                if (viewId === 'dashboard') {
                    title.innerText = 'Dashboard';
                } else {
                    const navLink = document.querySelector(`.nav-link[onclick*="'${viewId}'"]`);
                    if (navLink) {
                        title.innerText = navLink.querySelector('span').innerText;
                    }
                }
            }
        }

        function loadHistoryList() {
            const data = getSiteData();
            const tbody = document.getElementById('history-table-body');
            tbody.innerHTML = '';
            (data.history || []).forEach((item, index) => {
                const tr = document.createElement('tr');
                tr.style.borderBottom = '1px solid var(--light-gray)';
                tr.innerHTML = `
                    <td style="padding: 12px;">${item.year}</td>
                    <td style="padding: 12px;">${item.title}</td>
                    <td style="padding: 12px;">
                        <button onclick="editHistory(${index})" style="background: none; border: none; color: var(--primary); cursor: pointer; margin-right: 10px;"><i class="fas fa-edit"></i></button>
                        <button onclick="deleteHistory(${index})" style="background: none; border: none; color: #e74a3b; cursor: pointer;"><i class="fas fa-trash"></i></button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function editHistory(index) {
            const data = getSiteData();
            const item = data.history[index];
            editHistoryIndex = index;
            document.getElementById('history-year').value = item.year;
            document.getElementById('history-title').value = item.title;
            document.getElementById('history-desc').value = item.desc;
            document.querySelector('#add-history-form h4').innerText = 'Edit Milestone';
            document.querySelector('#add-history-form button').innerText = 'Update Milestone';
        }

        function deleteHistory(index) {
            if (confirm('Delete this history milestone?')) {
                const data = getSiteData();
                data.history.splice(index, 1);
                localStorage.setItem('ecostay_site_data', JSON.stringify(data));
                loadHistoryList();
            }
        }

        document.getElementById('add-history-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const data = getSiteData();
            const historyData = {
                year: document.getElementById('history-year').value,
                title: document.getElementById('history-title').value,
                desc: document.getElementById('history-desc').value
            };

            if (!data.history) data.history = [];

            if (editHistoryIndex > -1) {
                data.history[editHistoryIndex] = historyData;
                editHistoryIndex = -1;
                alert('Milestone updated!');
            } else {
                data.history.push(historyData);
                alert('Milestone added!');
            }

            localStorage.setItem('ecostay_site_data', JSON.stringify(data));
            e.target.reset();
            document.querySelector('#add-history-form h4').innerText = 'Add Milestone';
            document.querySelector('#add-history-form button').innerText = 'Add Milestone';
            loadHistoryList();
        });

        function loadDonationsList() {
            // Static for now, could be dynamic later
        }

        function loadTeamList() {
            const data = getSiteData();
            const container = document.getElementById('admin-team-grid');
            if (!container) return;
            container.innerHTML = '';
            (data.team || []).forEach((member, index) => {
                const card = document.createElement('div');
                card.className = 'chart-card';
                card.style.padding = '0';
                card.style.overflow = 'hidden';
                card.innerHTML = `
                    <div style="height: 150px; background-image: url('${member.image}'); background-size: cover; background-position: top;"></div>
                    <div style="padding: 15px;">
                        <h4 style="margin: 0; color: var(--text);">${member.name}</h4>
                        <p style="margin: 5px 0; font-size: 0.85rem; color: var(--primary); font-weight: 600;">${member.role}</p>
                        <p style="margin: 0; font-size: 0.8rem; color: var(--gray);">${member.dept}</p>
                        <div style="margin-top: 15px; display: flex; gap: 10px;">
                            <button onclick="editTeamMember(${index})" style="flex: 1; padding: 8px; background: #e3f2fd; color: #1976d2; border: none; border-radius: 4px; cursor: pointer; font-size: 0.8rem;"><i class="fas fa-edit"></i> Edit</button>
                            <button onclick="deleteTeamMember(${index})" style="flex: 1; padding: 8px; background: #ffebee; color: #c62828; border: none; border-radius: 4px; cursor: pointer; font-size: 0.8rem;"><i class="fas fa-trash"></i> Delete</button>
                        </div>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        function resetTeamForm() {
            editTeamIndex = -1;
            document.getElementById('add-team-form').reset();
            document.querySelector('#add-team-form h4').innerText = 'Add New Member';
            document.querySelector('#add-team-form button[type="submit"]').innerText = 'Add Member';
        }

        function editTeamMember(index) {
            const data = getSiteData();
            const member = data.team[index];
            editTeamIndex = index;
            document.getElementById('team-name').value = member.name;
            document.getElementById('team-role').value = member.role;
            document.getElementById('team-dept').value = member.dept;
            document.getElementById('team-image').value = member.image;
            document.getElementById('team-phone').value = member.phone || '';
            document.getElementById('team-email').value = member.email || '';
            document.querySelector('#add-team-form h4').innerText = 'Edit Member: ' + member.name;
            document.querySelector('#add-team-form button[type="submit"]').innerText = 'Update Member Info';
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function deleteTeamMember(index) {
            if (confirm('Are you sure you want to remove this team member? This update will reflect on the live website immediately.')) {
                const data = getSiteData();
                data.team.splice(index, 1);
                localStorage.setItem('ecostay_site_data', JSON.stringify(data));
                loadTeamList();
            }
        }

        document.getElementById('add-team-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const data = getSiteData();
            const memberData = {
                name: document.getElementById('team-name').value,
                role: document.getElementById('team-role').value,
                dept: document.getElementById('team-dept').value,
                image: document.getElementById('team-image').value,
                phone: document.getElementById('team-phone').value,
                email: document.getElementById('team-email').value
            };

            if (editTeamIndex > -1) {
                data.team[editTeamIndex] = memberData;
                editTeamIndex = -1;
            } else {
                data.team.push(memberData);
            }

            localStorage.setItem('ecostay_site_data', JSON.stringify(data));
            resetTeamForm();
            loadTeamList();
            alert('Website updated successfully!');
        });

        function loadEventsList() {
            const data = getSiteData();
            const container = document.getElementById('admin-events-grid');
            if (!container) return;
            container.innerHTML = '';
            (data.events || []).forEach((ev, index) => {
                const card = document.createElement('div');
                card.className = 'chart-card';
                card.style.padding = '0';
                card.style.overflow = 'hidden';
                card.innerHTML = `
                    <div style="height: 120px; background-image: url('${ev.image || 'img/event-placeholder.jpg'}'); background-size: cover; background-position: center;">
                        <div style="padding: 5px 10px; background: ${ev.status === 'Completed' ? '#2e7d32' : '#1976d2'}; color: white; display: inline-block; font-size: 0.7rem; font-weight: bold;">${ev.status}</div>
                    </div>
                    <div style="padding: 15px;">
                        <h4 style="margin: 0; font-size: 1rem;">${ev.title}</h4>
                        <p style="margin: 5px 0; font-size: 0.8rem; color: var(--gray);"><i class="fas fa-calendar-day"></i> ${ev.date} | <i class="fas fa-map-marker-alt"></i> ${ev.location}</p>
                        <div style="margin-top: 15px; display: flex; gap: 10px;">
                            <button onclick="editEvent(${index})" style="flex: 1; padding: 8px; background: #e3f2fd; color: #1976d2; border: none; border-radius: 4px; cursor: pointer; font-size: 0.8rem;"><i class="fas fa-edit"></i> Edit</button>
                            <button onclick="deleteEvent(${index})" style="flex: 1; padding: 8px; background: #ffebee; color: #c62828; border: none; border-radius: 4px; cursor: pointer; font-size: 0.8rem;"><i class="fas fa-trash"></i> Delete</button>
                        </div>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        function resetEventForm() {
            editEventIndex = -1;
            document.getElementById('add-event-form').reset();
            document.querySelector('#add-event-form h4').innerText = 'Add New Event';
            document.querySelector('#add-event-form button[type="submit"]').innerText = 'Add Event';
        }

        function editEvent(index) {
            const data = getSiteData();
            const ev = data.events[index];
            editEventIndex = index;
            document.getElementById('event-title').value = ev.title;
            document.getElementById('event-date').value = ev.date;
            document.getElementById('event-location').value = ev.location;
            document.getElementById('event-status').value = ev.status;
            document.getElementById('event-image').value = ev.image || '';
            document.getElementById('event-desc').value = ev.desc || '';
            document.querySelector('#add-event-form h4').innerText = 'Edit Event: ' + ev.title;
            document.querySelector('#add-event-form button[type="submit"]').innerText = 'Update Event Info';
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function deleteEvent(index) {
            if (confirm('Delete this event? It will be removed from the public website.')) {
                const data = getSiteData();
                data.events.splice(index, 1);
                localStorage.setItem('ecostay_site_data', JSON.stringify(data));
                loadEventsList();
            }
        }

        document.getElementById('add-event-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const data = getSiteData();
            const eventData = {
                title: document.getElementById('event-title').value,
                date: document.getElementById('event-date').value,
                location: document.getElementById('event-location').value,
                status: document.getElementById('event-status').value,
                image: document.getElementById('event-image').value,
                desc: document.getElementById('event-desc').value
            };

            if (editEventIndex > -1) {
                data.events[editEventIndex] = eventData;
                editEventIndex = -1;
            } else {
                data.events.push(eventData);
            }

            localStorage.setItem('ecostay_site_data', JSON.stringify(data));
            resetEventForm();
            loadEventsList();
            alert('Event list updated!');
        });

        function loadTestimonialsList() {
            const data = getSiteData();
            const tbody = document.getElementById('testi-table-body');
            tbody.innerHTML = '';
            (data.testimonials || []).forEach((testi, index) => {
                const tr = document.createElement('tr');
                tr.style.borderBottom = '1px solid var(--light-gray)';
                tr.innerHTML = `
                    <td style="padding: 12px;">${testi.name}</td>
                    <td style="padding: 12px; max-width: 300px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${testi.text}</td>
                    <td style="padding: 12px;">
                        <button onclick="editTesti(${index})" style="background: none; border: none; color: var(--primary); cursor: pointer; margin-right: 10px;"><i class="fas fa-edit"></i></button>
                        <button onclick="deleteTesti(${index})" style="background: none; border: none; color: #e74a3b; cursor: pointer;"><i class="fas fa-trash"></i></button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function editTesti(index) {
            const data = getSiteData();
            const t = data.testimonials[index];
            editTestiIndex = index;
            document.getElementById('testi-name').value = t.name;
            document.getElementById('testi-role').value = t.role;
            document.getElementById('testi-image').value = t.image || '';
            document.getElementById('testi-text').value = t.text;
            document.querySelector('#add-testi-form h4').innerText = 'Edit Testimonial';
            document.querySelector('#add-testi-form button').innerText = 'Update Testimonial';
        }

        function deleteTesti(index) {
            if (confirm('Delete this testimonial?')) {
                const data = getSiteData();
                data.testimonials.splice(index, 1);
                localStorage.setItem('ecostay_site_data', JSON.stringify(data));
                loadTestimonialsList();
            }
        }

        document.getElementById('add-testi-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const data = getSiteData();
            const testiData = {
                name: document.getElementById('testi-name').value,
                role: document.getElementById('testi-role').value,
                image: document.getElementById('testi-image').value,
                text: document.getElementById('testi-text').value
            };

            if (editTestiIndex > -1) {
                data.testimonials[editTestiIndex] = testiData;
                editTestiIndex = -1;
                alert('Testimonial updated!');
            } else {
                data.testimonials.push(testiData);
                alert('Testimonial added!');
            }

            localStorage.setItem('ecostay_site_data', JSON.stringify(data));
            e.target.reset();
            document.querySelector('#add-testi-form h4').innerText = 'Add New Testimonial';
            document.querySelector('#add-testi-form button').innerText = 'Add Testimonial';
            loadTestimonialsList();
        });

        function loadAdminStats() {
            const data = getSiteData();
            const users = getUsers();
            
            document.getElementById('admin-stat-members').innerText = users.length;
            document.getElementById('admin-stat-trees').innerText = data.impact.trees.toLocaleString();
        }

        function loadMembers() {
            const users = getUsers();
            const tbody = document.getElementById('members-table-body');
            tbody.innerHTML = '';

            users.forEach((user, index) => {
                const tr = document.createElement('tr');
                tr.style.borderBottom = '1px solid var(--light-gray)';
                tr.innerHTML = `
                    <td style="padding: 12px;">${user.name}</td>
                    <td style="padding: 12px;">${user.email}</td>
                    <td style="padding: 12px;"><span style="padding: 4px 8px; background: #e3f2fd; color: #1976d2; border-radius: 4px; font-size: 0.8rem;">${user.is_member ? 'Member' : 'User'}</span></td>
                    <td style="padding: 12px;">
                        <button onclick="deleteUser(${index})" style="background: none; border: none; color: #e74a3b; cursor: pointer;"><i class="fas fa-trash"></i></button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function deleteUser(index) {
            if (confirm('Are you sure you want to delete this user?')) {
                const users = getUsers();
                users.splice(index, 1);
                localStorage.setItem('ecostay_users', JSON.stringify(users));
                loadMembers();
                loadAdminStats();
            }
        }

        function loadContentForm() {
            const data = getSiteData();
            document.getElementById('edit-trees').value = data.impact.trees || 0;
            document.getElementById('edit-carbon').value = data.impact.carbon || 0;
            document.getElementById('edit-members-count').value = data.impact.members || 0;
            document.getElementById('edit-mission-title').value = data.mission.title || "";
            document.getElementById('edit-mission-text').value = data.mission.text_mission || "";
            document.getElementById('edit-who-text').value = data.who || "";
            document.getElementById('edit-vision-text').value = data.mission.text_vision || "";
            document.getElementById('edit-footer-email').value = data.footer?.email || "";
            document.getElementById('edit-footer-phone').value = data.footer?.phone || "";
            document.getElementById('edit-footer-address').value = data.footer?.address || "";
        }

        document.getElementById('edit-site-data-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const data = getSiteData();
            data.impact = {
                trees: parseInt(document.getElementById('edit-trees').value) || 0,
                carbon: parseInt(document.getElementById('edit-carbon').value) || 0,
                members: parseInt(document.getElementById('edit-members-count').value) || 0
            };
            data.mission = {
                title: document.getElementById('edit-mission-title').value,
                sub: "Driving Sustainable Change from the Heart of Rwanda",
                text_mission: document.getElementById('edit-mission-text').value,
                text_vision: document.getElementById('edit-vision-text').value
            };
            data.who = document.getElementById('edit-who-text').value;
            data.footer = {
                ...data.footer,
                email: document.getElementById('edit-footer-email').value,
                phone: document.getElementById('edit-footer-phone').value,
                address: document.getElementById('edit-footer-address').value
            };
            
            localStorage.setItem('ecostay_site_data', JSON.stringify(data));
            alert('Site data updated successfully!');
            loadAdminStats();
        });

        // Initialize
        switchView('dashboard');

        // Members Growth Chart
        const membersCtx = document.getElementById('membersChart').getContext('2d');
        const membersChart = new Chart(membersCtx, {
            type: 'line',
            data: {
                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul'],
                datasets: [{
                    label: 'New Members',
                    data: [65, 78, 66, 89, 96, 112, 124],
                    backgroundColor: 'rgba(26, 71, 42, 0.1)',
                    borderColor: '#1a472a',
                    borderWidth: 2,
                    tension: 0.3,
                    fill: true,
                    pointBackgroundColor: '#fff',
                    pointBorderColor: '#1a472a',
                    pointBorderWidth: 2,
                    pointRadius: 4,
                    pointHoverRadius: 6
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        backgroundColor: '#1a472a',
                        titleFont: { size: 14 },
                        bodyFont: { size: 14 },
                        padding: 12,
                        displayColors: false,
                        callbacks: {
                            label: function(context) {
                                return 'Members: ' + context.raw;
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        grid: {
                            color: 'rgba(0, 0, 0, 0.05)'
                        },
                        ticks: {
                            stepSize: 20
                        }
                    },
                    x: {
                        grid: {
                            display: false
                        }
                    }
                }
            }
        });

        // Events Chart
        const eventsCtx = document.getElementById('eventsChart').getContext('2d');
        const eventsChart = new Chart(eventsCtx, {
            type: 'doughnut',
            data: {
                labels: ['Completed', 'Ongoing', 'Upcoming', 'Cancelled'],
                datasets: [{
                    data: [15, 5, 7, 3],
                    backgroundColor: [
                        '#1a472a',
                        '#4CAF50',
                        '#8BC34A',
                        '#F44336'
                    ],
                    borderWidth: 0,
                    hoverOffset: 10
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                cutout: '70%',
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            padding: 20,
                            usePointStyle: true,
                            pointStyle: 'circle',
                            font: {
                                size: 12
                            }
                        }
                    },
                    tooltip: {
                        backgroundColor: '#1a472a',
                        titleFont: { size: 13 },
                        bodyFont: { size: 13 },
                        padding: 10,
                        displayColors: false,
                        callbacks: {
                            label: function(context) {
                                const label = context.label || '';
                                const value = context.raw || 0;
                                const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                const percentage = Math.round((value / total) * 100);
                                return `${label}: ${value} (${percentage}%)`;
                            }
                        }
                    }
                }
            }
        });

        // Toggle sidebar on mobile
        document.querySelector('.hamburger').addEventListener('click', function() {
            document.querySelector('.sidebar').classList.toggle('collapsed');
            document.querySelector('.main-content').classList.toggle('expanded');
        });

        // Chart period toggle
        const chartBtns = document.querySelectorAll('.chart-btn');
        chartBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                // Remove active class from all buttons in the same group
                this.parentElement.querySelectorAll('.chart-btn').forEach(b => {
                    b.classList.remove('active');
                });
                // Add active class to clicked button
                this.classList.add('active');
                
                // Here you would typically update the chart data based on the selected period
                // For now, we'll just log the selected period
                console.log('Selected period:', this.textContent.trim());
            });
        });
    </script>
</body>
</html>
